/**
 * å…§å®¹éæ¿¾æœå‹™
 * è² è²¬èªè¨€çµ±ä¸€ã€è¡“èªæ ¡æ­£ã€HTMLä¿®å¾©ã€å…§å®¹å“è³ªæª¢æŸ¥ç­‰å¾Œè™•ç†ä»»å‹™
 */

class ContentFilterService {
  /**
   * æ©Ÿæ¢°å¼å¥å‹æ¨¡æ¿ï¼ˆéœ€è¦è¢«æª¢æ¸¬ä¸¦æ¨™è¨˜çš„å•é¡Œæ¨¡å¼ï¼‰
   */
  static mechanicalPatterns = [
    /åœ¨æ¢è¨.*?çš„éç¨‹ä¸­ï¼Œæˆ‘å€‘ç™¼ç¾/g,
    /é‡å°.*?é€™å€‹è­°é¡Œï¼Œå°ˆå®¶å»ºè­°/g,
    /è‹¥æ‚¨æ­£å—.*?æ‰€è‹¦ï¼Œ/g,
    /äº‹å¯¦ä¸Šï¼Œ.*?èˆ‡ç”Ÿæ´»ç¿’æ…£æ¯æ¯ç›¸é—œï¼Œ/g,
    /å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ.*?ä¸¦éä¸€è¹´å¯å¹¾ï¼Œ/g,
    /æ·±å…¥äº†è§£.*?å¾Œï¼Œ/g,
    /æƒ³è¦æœ‰æ•ˆé”æˆ.*?ï¼Œé—œéµåœ¨æ–¼/g,
    /å¯¦è¸.*?çš„ç¬¬ä¸€æ­¥æ˜¯/g
  ];

  /**
   * è™›å‡è²ç¨±æ¨¡å¼ï¼ˆéœ€è¦è¢«ç§»é™¤çš„ä¸å¯è¿½æº¯è²ç¨±ï¼‰
   */
  static falseClaimPatterns = [
    /æ ¹æ“šæˆ‘å€‘åœ˜éšŠ(çš„)?(æ¸¬è©¦|æ•¸æ“š|ç¶“é©—|è§€å¯Ÿ)/g,
    /æ ¹æ“šæˆ‘çš„(è§€å¯Ÿ|ç¶“é©—|åˆ¤æ–·)/g,
    /åœ¨æˆ‘æœå‹™çš„.*?(ä¸­|è£¡)/g,
    /æˆ‘æœ‰ä¸€ä½(å®¢æˆ¶|æœ‹å‹|å­¸ç”Ÿ)/g,
    /æˆ‘æ›¾ç¶“(é‡é|æ¸¬è©¦é|å˜—è©¦é)/g,
    /æˆ‘è¦ªèº«ç¶“æ­·/g,
    /åœ¨æˆ‘çš„è«®è©¢ç¶“é©—ä¸­/g,
    /æ ¹æ“šæˆ‘å¤šå¹´çš„å¯¦å‹™ç¶“é©—/g
  ];

  /**
   * ç°¡é«”å­—åˆ°ç¹é«”å­—çš„å°ç…§è¡¨
   */
  static simplifiedToTraditionalMap = {
    // å¸¸è¦‹ç°¡é«”å­—
    'ç„¦è™‘': 'ç„¦æ…®',
    'æŠ‘éƒ': 'æ†‚é¬±',
    'å¿§éƒ': 'æ†‚é¬±',
    'é¦™æ°”': 'é¦™æ°£',
    'è®¤çŸ¥': 'èªçŸ¥',
    'è´¨é‡': 'è³ªé‡',
    'å“è´¨': 'å“è³ª',
    'èŒƒå›´': 'ç¯„åœ',
    'ç¯å¢ƒ': 'ç’°å¢ƒ',
    'åŒ»å­¦': 'é†«å­¸',
    'åŒ»ç”Ÿ': 'é†«ç”Ÿ',
    'åŒ»ç–—': 'é†«ç™‚',
    'è¯ç‰©': 'è—¥ç‰©',
    'è¥å…»': 'ç‡Ÿé¤Š',
    'è¿åŠ¨': 'é‹å‹•',
    'é”»ç‚¼': 'é›éŠ',
    'å‹åŠ›': 'å£“åŠ›',
    'ç´§å¼ ': 'ç·Šå¼µ',
    'æ¾å¼›': 'é¬†å¼›',
    'è°ƒæ•´': 'èª¿æ•´',
    'è°ƒèŠ‚': 'èª¿ç¯€',
    'è°ƒæŸ¥': 'èª¿æŸ¥',
    'æ ‡å‡†': 'æ¨™æº–',
    'è§„å¾‹': 'è¦å¾‹',
    'ä¹ æƒ¯': 'ç¿’æ…£',
    'ä½“éªŒ': 'é«”é©—',
    'ç»éªŒ': 'ç¶“é©—',
    'å®é™…': 'å¯¦éš›',
    'å®è·µ': 'å¯¦è¸',
    'ä¸“å®¶': 'å°ˆå®¶',
    'ä¸“ä¸š': 'å°ˆæ¥­',
    'ç ”ç©¶': 'ç ”ç©¶',
    'æ˜¾ç¤º': 'é¡¯ç¤º',
    'å‘ç°': 'ç™¼ç¾',
    'è§‚å¯Ÿ': 'è§€å¯Ÿ',
    'è®°å½•': 'è¨˜éŒ„',
    'æ•°æ®': 'æ•¸æ“š',
    'ç»Ÿè®¡': 'çµ±è¨ˆ',
    'æŠ¥å‘Š': 'å ±å‘Š',
    'èµ„æ–™': 'è³‡æ–™',
    'èµ„è®¯': 'è³‡è¨Š',
    'ä¿¡æ¯': 'è³‡è¨Š',
    'é—®é¢˜': 'å•é¡Œ',
    'è®®é¢˜': 'è­°é¡Œ',
    'ç°è±¡': 'ç¾è±¡',
    'çŠ¶å†µ': 'ç‹€æ³',
    'æƒ…å†µ': 'æƒ…æ³',
    'æ—¶é—´': 'æ™‚é–“',
    'è¿‡ç¨‹': 'éç¨‹',
    'ç»“æœ': 'çµæœ',
    'æ•ˆæœ': 'æ•ˆæœ',
    'å½±å“': 'å½±éŸ¿',
    'å¯¼è‡´': 'å°è‡´',
    'äº§ç”Ÿ': 'ç”¢ç”Ÿ',
    'è·å¾—': 'ç²å¾—',
    'è¾¾åˆ°': 'é”åˆ°',
    'å®ç°': 'å¯¦ç¾',
    'è¿›è¡Œ': 'é€²è¡Œ',
    'ç»§ç»­': 'ç¹¼çºŒ',
    'ç»´æŒ': 'ç¶­æŒ',
    'ä¿æŒ': 'ä¿æŒ',
    'ç¡®ä¿': 'ç¢ºä¿',
    'å°è¯•': 'å˜—è©¦',
    'è¯•éªŒ': 'è©¦é©—',
    'æµ‹è¯•': 'æ¸¬è©¦',
    'æ£€æŸ¥': 'æª¢æŸ¥',
    'è¯Šæ–­': 'è¨ºæ–·',
    'æ²»ç–—': 'æ²»ç™‚',
    'ç–—æ³•': 'ç™‚æ³•',
    'é¢„é˜²': 'é é˜²',
    'æŠ¤ç†': 'è­·ç†',
    'å…³æ³¨': 'é—œæ³¨',
    'æ³¨æ„': 'æ³¨æ„',
    'é‡è§†': 'é‡è¦–',
    'å¼ºè°ƒ': 'å¼·èª¿',
    'æå‡': 'æå‡',
    'æ”¹å–„': 'æ”¹å–„',
    'ä¼˜åŒ–': 'å„ªåŒ–',
    'å¢å¼º': 'å¢å¼·',
    'å‡å°‘': 'æ¸›å°‘',
    'é™ä½': 'é™ä½',
    'é¿å…': 'é¿å…',
    'é˜²æ­¢': 'é˜²æ­¢',
    'ç¼“è§£': 'ç·©è§£',
    'å¸®åŠ©': 'å¹«åŠ©',
    'ååŠ©': 'å”åŠ©',
    'æ”¯æŒ': 'æ”¯æŒ',
    'é¼“åŠ±': 'é¼“å‹µ',
    'å»ºè®®': 'å»ºè­°',
    'æ¨è': 'æ¨è–¦',
    'é€‰æ‹©': 'é¸æ“‡',
    'åº”è¯¥': 'æ‡‰è©²',
    'éœ€è¦': 'éœ€è¦',
    'å¿…é¡»': 'å¿…é ˆ',
    'å¯ä»¥': 'å¯ä»¥',
    'èƒ½å¤Ÿ': 'èƒ½å¤ ',
    'æ— æ³•': 'ç„¡æ³•',
    'éš¾ä»¥': 'é›£ä»¥',
    'å®¹æ˜“': 'å®¹æ˜“',
    'ç®€å•': 'ç°¡å–®',
    'å¤æ‚': 'è¤‡é›œ',
    'å›°éš¾': 'å›°é›£',
    'æŒ‘æˆ˜': 'æŒ‘æˆ°',
    'é—®é¢˜': 'å•é¡Œ',
    'è§£å†³': 'è§£æ±º',
    'å¤„ç†': 'è™•ç†',
    'åº”å¯¹': 'æ‡‰å°',
    'é¢å¯¹': 'é¢å°',
    'å…‹æœ': 'å…‹æœ',
    'é€‚åº”': 'é©æ‡‰',
    'è°ƒé€‚': 'èª¿é©',
    'å­¦ä¹ ': 'å­¸ç¿’',
    'è®­ç»ƒ': 'è¨“ç·´',
    'ç»ƒä¹ ': 'ç·´ç¿’',
    'äº†è§£': 'äº†è§£',
    'ç†è§£': 'ç†è§£',
    'è®¤è¯†': 'èªè­˜',
    'æŒæ¡': 'æŒæ¡',
    'æä¾›': 'æä¾›',
    'è·å–': 'ç²å–',
    'æ”¶é›†': 'æ”¶é›†',
    'æ•´ç†': 'æ•´ç†',
    'åˆ†æ': 'åˆ†æ',
    'è¯„ä¼°': 'è©•ä¼°',
    'åˆ¤æ–­': 'åˆ¤æ–·',
    'ç¡®è®¤': 'ç¢ºèª',
    'éªŒè¯': 'é©—è­‰',
    'è¯æ˜': 'è­‰æ˜',
    'è¯æ®': 'è­‰æ“š',
    'è¯å®': 'è­‰å¯¦',
    'è¡¨æ˜': 'è¡¨æ˜',
    'è¯´æ˜': 'èªªæ˜',
    'è§£é‡Š': 'è§£é‡‹',
    'æè¿°': 'æè¿°',
    'å™è¿°': 'æ•˜è¿°',
    'è®¨è®º': 'è¨è«–',
    'æ¢è®¨': 'æ¢è¨',
    'ç ”è®¨': 'ç ”è¨',
    'å‚è€ƒ': 'åƒè€ƒ',
    'å¼•ç”¨': 'å¼•ç”¨',
    'æ ¹æ®': 'æ ¹æ“š',
    'ä¾æ®': 'ä¾æ“š',
    'åŸºäº': 'åŸºæ–¼',
    'å…³äº': 'é—œæ–¼',
    'å¯¹äº': 'å°æ–¼',
    'ç”±äº': 'ç”±æ–¼',
    'å› ä¸º': 'å› ç‚º',
    'æ‰€ä»¥': 'æ‰€ä»¥',
    'ä½†æ˜¯': 'ä½†æ˜¯',
    'ç„¶è€Œ': 'ç„¶è€Œ',
    'è™½ç„¶': 'é›–ç„¶',
    'å°½ç®¡': 'å„˜ç®¡',
    'æ— è®º': 'ç„¡è«–',
    'ä¸ç®¡': 'ä¸ç®¡',
    'å¦å¤–': 'å¦å¤–',
    'æ­¤å¤–': 'æ­¤å¤–',
    'è€Œä¸”': 'è€Œä¸”',
    'å¹¶ä¸”': 'ä¸¦ä¸”',
    'åŒæ—¶': 'åŒæ™‚',
    'æ€»ä¹‹': 'ç¸½ä¹‹',
    'æ€»ç»“': 'ç¸½çµ',
    'ç»¼åˆ': 'ç¶œåˆ',
    'æ•´ä½“': 'æ•´é«”',
    'å…¨é¢': 'å…¨é¢',
    'å…·ä½“': 'å…·é«”',
    'è¯¦ç»†': 'è©³ç´°',
    'æ¸…æ¥š': 'æ¸…æ¥š',
    'æ˜ç¡®': 'æ˜ç¢º',
    'æ­£ç¡®': 'æ­£ç¢º',
    'å‡†ç¡®': 'æº–ç¢º',
    'çœŸå®': 'çœŸå¯¦',
    'å®åœ¨': 'å¯¦åœ¨',
    'ç¡®å®': 'ç¢ºå¯¦',
    'çš„ç¡®': 'çš„ç¢º',
    'å½“ç„¶': 'ç•¶ç„¶',
    'è‡ªç„¶': 'è‡ªç„¶',
    'å¿…ç„¶': 'å¿…ç„¶',
    'æ˜¾ç„¶': 'é¡¯ç„¶',
    'æ˜æ˜¾': 'æ˜é¡¯',
    'æ¸…æ™°': 'æ¸…æ™°',
    'é€æ˜': 'é€æ˜',
    'å®Œæ•´': 'å®Œæ•´',
    'å®Œå…¨': 'å®Œå…¨',
    'å½»åº•': 'å¾¹åº•',
    'å……åˆ†': 'å……åˆ†',
    'è¶³å¤Ÿ': 'è¶³å¤ ',
    'ä¸°å¯Œ': 'è±å¯Œ',
    'å¹¿æ³›': 'å»£æ³›',
    'æ·±å…¥': 'æ·±å…¥',
    'è¯¦å°½': 'è©³ç›¡',
    'ä»”ç»†': 'ä»”ç´°',
    'è®¤çœŸ': 'èªçœŸ',
    'ä¸¥æ ¼': 'åš´æ ¼',
    'ä¸¥è°¨': 'åš´è¬¹',
    'è§„èŒƒ': 'è¦ç¯„',
    'æ ‡å¿—': 'æ¨™èªŒ',
    'è®°å·': 'è¨˜è™Ÿ',
    'ç¬¦å·': 'ç¬¦è™Ÿ',
    'å·ç ': 'è™Ÿç¢¼',
    'æ•°å­—': 'æ•¸å­—',
    'æ•°é‡': 'æ•¸é‡',
    'æ¯”ä¾‹': 'æ¯”ä¾‹',
    'ç™¾åˆ†æ¯”': 'ç™¾åˆ†æ¯”',
    'é¢‘ç‡': 'é »ç‡',
    'ç¨‹åº¦': 'ç¨‹åº¦',
    'æ°´å¹³': 'æ°´å¹³',
    'å±‚æ¬¡': 'å±¤æ¬¡',
    'çº§åˆ«': 'ç´šåˆ¥',
    'ç­‰çº§': 'ç­‰ç´š',
    'ç±»å‹': 'é¡å‹',
    'ç§ç±»': 'ç¨®é¡',
    'æ–¹å¼': 'æ–¹å¼',
    'æ–¹æ³•': 'æ–¹æ³•',
    'é€”å¾„': 'é€”å¾‘',
    'æ‰‹æ®µ': 'æ‰‹æ®µ',
    'å·¥å…·': 'å·¥å…·',
    'æŠ€æœ¯': 'æŠ€è¡“',
    'æŠ€å·§': 'æŠ€å·§',
    'ç­–ç•¥': 'ç­–ç•¥',
    'æªæ–½': 'æªæ–½',
    'æ­¥éª¤': 'æ­¥é©Ÿ',
    'é˜¶æ®µ': 'éšæ®µ',
    'è¿‡æ¸¡': 'éæ¸¡',
    'è½¬å˜': 'è½‰è®Š',
    'å˜åŒ–': 'è®ŠåŒ–',
    'æ”¹å˜': 'æ”¹è®Š',
    'å‘å±•': 'ç™¼å±•',
    'è¿›å±•': 'é€²å±•',
    'è¿›æ­¥': 'é€²æ­¥',
    'æˆé•¿': 'æˆé•·',
    'æé«˜': 'æé«˜',
    'å¢åŠ ': 'å¢åŠ ',
    'æ‰©å¤§': 'æ“´å¤§',
    'å»¶é•¿': 'å»¶é•·',
    'ç¼©çŸ­': 'ç¸®çŸ­',
    'å‡è½»': 'æ¸›è¼•',
    'åŠ é‡': 'åŠ é‡',
    'å¼ºåŒ–': 'å¼·åŒ–',
    'å¼±åŒ–': 'å¼±åŒ–',
    'æ¢å¤': 'æ¢å¾©',
    'å¤åŸ': 'å¾©åŸ',
    'åº·å¤': 'åº·å¾©',
    'å¥åº·': 'å¥åº·',
    'ç–¾ç—…': 'ç–¾ç—…',
    'ç—‡çŠ¶': 'ç—‡ç‹€',
    'ç—…ç—‡': 'ç—…ç—‡',
    'éšœç¢': 'éšœç¤™',
    'åŠŸèƒ½': 'åŠŸèƒ½',
    'ä½œç”¨': 'ä½œç”¨',
    'ååº”': 'åæ‡‰',
    'å“åº”': 'éŸ¿æ‡‰',
    'å˜åŠ¨': 'è®Šå‹•',
    'æ³¢åŠ¨': 'æ³¢å‹•',
    'ç¨³å®š': 'ç©©å®š',
    'å¹³è¡¡': 'å¹³è¡¡',
    'åè°ƒ': 'å”èª¿',
    'é…åˆ': 'é…åˆ',
    'ç»“åˆ': 'çµåˆ',
    'è”ç³»': 'è¯ç¹«',
    'è¿æ¥': 'é€£æ¥',
    'å…³ç³»': 'é—œä¿‚',
    'ç›¸å…³': 'ç›¸é—œ',
    'äº’ç›¸': 'äº’ç›¸',
    'å½¼æ­¤': 'å½¼æ­¤',
    'å…±åŒ': 'å…±åŒ',
    'ä¸€èµ·': 'ä¸€èµ·',
    'åŒæ ·': 'åŒæ¨£',
    'ç±»ä¼¼': 'é¡ä¼¼',
    'ç›¸ä¼¼': 'ç›¸ä¼¼',
    'ä¸åŒ': 'ä¸åŒ',
    'å·®å¼‚': 'å·®ç•°',
    'åŒºåˆ«': 'å€åˆ¥',
    'åˆ†åˆ«': 'åˆ†åˆ¥',
    'å„è‡ª': 'å„è‡ª',
    'å•ç‹¬': 'å–®ç¨',
    'ç‹¬ç«‹': 'ç¨ç«‹',
    'ä¸ªåˆ«': 'å€‹åˆ¥',
    'ç‰¹åˆ«': 'ç‰¹åˆ¥',
    'ç‰¹æ®Š': 'ç‰¹æ®Š',
    'ç‹¬ç‰¹': 'ç¨ç‰¹',
    'å”¯ä¸€': 'å”¯ä¸€',
    'ä»…æœ‰': 'åƒ…æœ‰',
    'åªæœ‰': 'åªæœ‰',
    'ä¸»è¦': 'ä¸»è¦',
    'é‡è¦': 'é‡è¦',
    'å…³é”®': 'é—œéµ',
    'æ ¸å¿ƒ': 'æ ¸å¿ƒ',
    'ä¸­å¿ƒ': 'ä¸­å¿ƒ',
    'ç„¦ç‚¹': 'ç„¦é»',
    'é‡ç‚¹': 'é‡é»',
    'è¦ç‚¹': 'è¦é»',
    'åŸºç¡€': 'åŸºç¤',
    'æ ¹æœ¬': 'æ ¹æœ¬',
    'åŸºæœ¬': 'åŸºæœ¬',
    'åˆæ­¥': 'åˆæ­¥',
    'å¼€å§‹': 'é–‹å§‹',
    'èµ·åˆ': 'èµ·åˆ',
    'æœ€åˆ': 'æœ€åˆ',
    'é¦–å…ˆ': 'é¦–å…ˆ',
    'ç„¶å': 'ç„¶å¾Œ',
    'æ¥ç€': 'æ¥è‘—',
    'éšå': 'éš¨å¾Œ',
    'æœ€å': 'æœ€å¾Œ',
    'ç»ˆäº': 'çµ‚æ–¼',
    'ç»ˆæ­¢': 'çµ‚æ­¢',
    'ç»“æŸ': 'çµæŸ',
    'å®Œæˆ': 'å®Œæˆ',
    'è¾¾æˆ': 'é”æˆ',
    'å®ç°': 'å¯¦ç¾',
    'æˆåŠŸ': 'æˆåŠŸ',
    'å¤±è´¥': 'å¤±æ•—',
    'é”™è¯¯': 'éŒ¯èª¤',
    'æ­£ç¡®': 'æ­£ç¢º',
    'å¯¹é”™': 'å°éŒ¯',
    'æ˜¯é': 'æ˜¯é',
    'ä¼˜ç¼ºç‚¹': 'å„ªç¼ºé»',
    'ä¼˜åŠ¿': 'å„ªå‹¢',
    'åŠ£åŠ¿': 'åŠ£å‹¢',
    'ä¼˜ç‚¹': 'å„ªé»',
    'ç¼ºç‚¹': 'ç¼ºé»',
    'é•¿å¤„': 'é•·è™•',
    'çŸ­å¤„': 'çŸ­è™•',
    'å¥½å¤„': 'å¥½è™•',
    'åå¤„': 'å£è™•',
    'åˆ©å¼Š': 'åˆ©å¼Š',
    'å¾—å¤±': 'å¾—å¤±',
    'æ”¶è·': 'æ”¶ç©«',
    'æŸå¤±': 'æå¤±',
    'é£é™©': 'é¢¨éšª',
    'å±é™©': 'å±éšª',
    'å®‰å…¨': 'å®‰å…¨',
    'ä¿éšœ': 'ä¿éšœ',
    'æ‹…å¿ƒ': 'æ“”å¿ƒ',
    'å¿§è™‘': 'æ†‚æ…®',
    'é¡¾è™‘': 'é¡§æ…®',
    'çƒ¦æ¼': 'ç…©æƒ±',
    'å›°æ‰°': 'å›°æ“¾',
    'ç—›è‹¦': 'ç—›è‹¦',
    'éš¾å—': 'é›£å—',
    'èˆ’æœ': 'èˆ’æœ',
    'èˆ’é€‚': 'èˆ’é©',
    'æ„‰å¿«': 'æ„‰å¿«',
    'å¼€å¿ƒ': 'é–‹å¿ƒ',
    'é«˜å…´': 'é«˜èˆˆ',
    'æ»¡æ„': 'æ»¿æ„',
    'æ»¡è¶³': 'æ»¿è¶³',
    'å……å®': 'å……å¯¦',
    'ä¸°æ»¡': 'è±æ»¿',
    'é¥±æ»¡': 'é£½æ»¿',
    'é¥±å’Œ': 'é£½å’Œ',
    'è¿‡åº¦': 'éåº¦',
    'è¿‡é‡': 'éé‡',
    'è¿‡å¤š': 'éå¤š',
    'è¿‡å°‘': 'éå°‘',
    'ä¸è¶³': 'ä¸è¶³',
    'æ¬ ç¼º': 'æ¬ ç¼º',
    'ç¼ºä¹': 'ç¼ºä¹',
    'ç¼ºå°‘': 'ç¼ºå°‘',
    'ç¼ºå¤±': 'ç¼ºå¤±',
    'é—æ¼': 'éºæ¼',
    'é—å¿˜': 'éºå¿˜',
    'å¿˜è®°': 'å¿˜è¨˜',
    'è®°å¾—': 'è¨˜å¾—',
    'è®°å¿†': 'è¨˜æ†¶',
    'å›å¿†': 'å›æ†¶',
    'æƒ³èµ·': 'æƒ³èµ·',
    'è”æƒ³': 'è¯æƒ³',
    'æ€è€ƒ': 'æ€è€ƒ',
    'è€ƒè™‘': 'è€ƒæ…®',
    'æ€è™‘': 'æ€æ…®',
    'åæ€': 'åæ€',
    'æ£€è®¨': 'æª¢è¨',
    'å®¡è§†': 'å¯©è¦–',
    'è§‚ç‚¹': 'è§€é»',
    'è§è§£': 'è¦‹è§£',
    'çœ‹æ³•': 'çœ‹æ³•',
    'æ€åº¦': 'æ…‹åº¦',
    'ç«‹åœº': 'ç«‹å ´',
    'è§‚å¿µ': 'è§€å¿µ',
    'æ¦‚å¿µ': 'æ¦‚å¿µ',
    'æ„è¯†': 'æ„è­˜',
    'è®¤çŸ¥': 'èªçŸ¥',
    'çŸ¥è¯†': 'çŸ¥è­˜',
    'å¸¸è¯†': 'å¸¸è­˜',
    'è§è¯†': 'è¦‹è­˜',
    'ç»å†': 'ç¶“æ­·',
    'å†å²': 'æ­·å²',
    'ä¼ ç»Ÿ': 'å‚³çµ±',
    'ä¹ ä¿—': 'ç¿’ä¿—',
    'é£ä¿—': 'é¢¨ä¿—',
    'æ–‡åŒ–': 'æ–‡åŒ–',
    'ç¤¾ä¼š': 'ç¤¾æœƒ',
    'ç¾¤ä½“': 'ç¾¤é«”',
    'å›¢ä½“': 'åœ˜é«”',
    'ç»„ç»‡': 'çµ„ç¹”',
    'æœºæ„': 'æ©Ÿæ§‹',
    'å•ä½': 'å–®ä½',
    'éƒ¨é—¨': 'éƒ¨é–€',
    'é¢†åŸŸ': 'é ˜åŸŸ',
    'èŒƒç•´': 'ç¯„ç–‡',
    'å±‚é¢': 'å±¤é¢',
    'æ–¹é¢': 'æ–¹é¢',
    'è§’åº¦': 'è§’åº¦',
    'è§†è§’': 'è¦–è§’',
    'è§‚å¯Ÿ': 'è§€å¯Ÿ',
    'å‘è§‰': 'ç™¼è¦º',
    'å¯Ÿè§‰': 'å¯Ÿè¦º',
    'æ„Ÿè§‰': 'æ„Ÿè¦º',
    'æ„Ÿå—': 'æ„Ÿå—',
    'ä½“ä¼š': 'é«”æœƒ',
    'ä½“æ‚Ÿ': 'é«”æ‚Ÿ',
    'é¢†æ‚Ÿ': 'é ˜æ‚Ÿ',
    'ç†ä¼š': 'ç†æœƒ',
    'æ˜ç™½': 'æ˜ç™½',
    'æ‡‚å¾—': 'æ‡‚å¾—',
    'æ™“å¾—': 'æ›‰å¾—',
    'çŸ¥æ™“': 'çŸ¥æ›‰',
    'å‘ŠçŸ¥': 'å‘ŠçŸ¥',
    'é€šçŸ¥': 'é€šçŸ¥',
    'ä¼ è¾¾': 'å‚³é”',
    'ä¼ é€’': 'å‚³é',
    'ä¼ æ’­': 'å‚³æ’­',
    'æ‰©æ•£': 'æ“´æ•£',
    'ä¼ æŸ“': 'å‚³æŸ“',
    'æ„ŸæŸ“': 'æ„ŸæŸ“',
    'å½±å“': 'å½±éŸ¿',
    'æ¶‰åŠ': 'æ¶‰åŠ',
    'å…³è”': 'é—œè¯',
    'ç‰µæ¶‰': 'ç‰½æ¶‰',
    'ç‰µè¿': 'ç‰½é€£',
    'è¿å¸¦': 'é€£å¸¶',
    'é™„å¸¦': 'é™„å¸¶',
    'ä¼´éš': 'ä¼´éš¨',
    'éšç€': 'éš¨è‘—',
    'è·Ÿéš': 'è·Ÿéš¨',
    'ä¾ç…§': 'ä¾ç…§',
    'æŒ‰ç…§': 'æŒ‰ç…§',
    'éµç…§': 'éµç…§',
    'éµå®ˆ': 'éµå®ˆ',
    'æœä»': 'æœå¾',
    'å¬ä»': 'è½å¾',
    'é‡‡çº³': 'æ¡ç´',
    'æ¥å—': 'æ¥å—',
    'æ‰¿è®¤': 'æ‰¿èª',
    'è®¤å¯': 'èªå¯',
    'èµåŒ': 'è´ŠåŒ',
    'èµæˆ': 'è´Šæˆ',
    'åŒæ„': 'åŒæ„',
    'åå¯¹': 'åå°',
    'å¦è®¤': 'å¦èª',
    'æ‹’ç»': 'æ‹’çµ•',
    'æ’æ–¥': 'æ’æ–¥',
    'æŠµæŠ—': 'æŠµæŠ—',
    'æŠµåˆ¶': 'æŠµåˆ¶',
    'é˜²èŒƒ': 'é˜²ç¯„',
    'è­¦æƒ•': 'è­¦æƒ•',
    'è°¨æ…': 'è¬¹æ…',
    'å°å¿ƒ': 'å°å¿ƒ',
    'ä»”ç»†': 'ä»”ç´°',
    'ç»†å¿ƒ': 'ç´°å¿ƒ',
    'ç»†è‡´': 'ç´°ç·»',
    'ç²¾ç»†': 'ç²¾ç´°',
    'ç²¾ç¡®': 'ç²¾ç¢º',
    'ç²¾å‡†': 'ç²¾æº–',
    'å‡†æ—¶': 'æº–æ™‚',
    'åŠæ—¶': 'åŠæ™‚',
    'é€‚æ—¶': 'é©æ™‚',
    'å½“æ—¶': 'ç•¶æ™‚',
    'ç°åœ¨': 'ç¾åœ¨',
    'ç›®å‰': 'ç›®å‰',
    'å½“å‰': 'ç•¶å‰',
    'å¦‚ä»Š': 'å¦‚ä»Š',
    'ä»Šå¤©': 'ä»Šå¤©',
    'æ˜¨å¤©': 'æ˜¨å¤©',
    'æ˜å¤©': 'æ˜å¤©',
    'å°†æ¥': 'å°‡ä¾†',
    'æœªæ¥': 'æœªä¾†',
    'è¿‡å»': 'éå»',
    'ä»å‰': 'å¾å‰',
    'ä»¥å‰': 'ä»¥å‰',
    'ä¹‹å‰': 'ä¹‹å‰',
    'ä»¥å': 'ä»¥å¾Œ',
    'ä¹‹å': 'ä¹‹å¾Œ',
    'åæ¥': 'å¾Œä¾†',
    'æ¥ä¸‹æ¥': 'æ¥ä¸‹ä¾†',
    'ä¸‹ä¸€æ­¥': 'ä¸‹ä¸€æ­¥',
    'è¿›ä¸€æ­¥': 'é€²ä¸€æ­¥',
    'æ›´è¿›ä¸€æ­¥': 'æ›´é€²ä¸€æ­¥',
    'å†æ¬¡': 'å†æ¬¡',
    'é‡æ–°': 'é‡æ–°',
    'é‡å¤': 'é‡è¤‡',
    'åå¤': 'åè¦†',
    'å¤šæ¬¡': 'å¤šæ¬¡',
    'å±¡æ¬¡': 'å±¢æ¬¡',
    'é¢‘ç¹': 'é »ç¹',
    'ç»å¸¸': 'ç¶“å¸¸',
    'å¸¸å¸¸': 'å¸¸å¸¸',
    'å¾€å¾€': 'å¾€å¾€',
    'é€šå¸¸': 'é€šå¸¸',
    'ä¸€èˆ¬': 'ä¸€èˆ¬',
    'æ™®é€š': 'æ™®é€š',
    'å¯»å¸¸': 'å°‹å¸¸',
    'å¹³å¸¸': 'å¹³å¸¸',
    'æ­£å¸¸': 'æ­£å¸¸',
    'å¼‚å¸¸': 'ç•°å¸¸',
    'ç‰¹æ®Š': 'ç‰¹æ®Š',
    'ç½•è§': 'ç½•è¦‹',
    'ç¨€æœ‰': 'ç¨€æœ‰',
    'ç¨€å°‘': 'ç¨€å°‘',
    'å°‘è§': 'å°‘è¦‹',
    'å°‘æœ‰': 'å°‘æœ‰',
    'éš¾å¾—': 'é›£å¾—',
    'å®è´µ': 'å¯¶è²´',
    'çè´µ': 'çè²´',
    'è´µé‡': 'è²´é‡',
    'é‡è¦': 'é‡è¦',
    'å…³é”®': 'é—œéµ',
    'ç´§è¦': 'ç·Šè¦',
    'å¿…è¦': 'å¿…è¦',
    'éœ€è¦': 'éœ€è¦'
  };

  /**
   * å¥åº·é†«ç™‚é ˜åŸŸå°ˆæ¥­è¡“èªæ ¡æ­£è¡¨
   */
  static terminologyCorrections = {
    'health': {
      'é‡é‡‘å±¬é£²é£Ÿ': 'é‡å£å‘³é£²é£Ÿ',
      'é‡é‡‘å±é£²é£Ÿ': 'é‡å£å‘³é£²é£Ÿ',
      'é‡é‡‘å±é¥®é£Ÿ': 'é‡å£å‘³é£²é£Ÿ',
      'ä¿ƒé€²çœ ': 'ä¿ƒé€²ç¡çœ ',
      'ä¿ƒè¿›çœ ': 'ä¿ƒé€²ç¡çœ ',
      '.sleep': 'ç¡çœ ',
      'é•·æ™‚é–“.sleep': 'é•·æ™‚é–“ç¡çœ ',
      'tuá»•i trÆ°á»Ÿng thÃ nh': 'å¹´é½¡å¢é•·',
      'å¤±çœ ç—‡æ‚£è€…': 'å¤±çœ æ‚£è€…',
      'ç¡çœ è´¨é‡': 'ç¡çœ å“è³ª',
      'ç¡çœ è´¨': 'ç¡çœ å“è³ª',
      'ç¡è§‰è´¨é‡': 'ç¡çœ å“è³ª',
      'å…¥ç¡å›°é›£ç—‡': 'å…¥ç¡å›°é›£',
      'æ·±åº¦ç¡çœ ': 'æ·±å±¤ç¡çœ ',
      'æµ…ç¡çœ ': 'æ·ºå±¤ç¡çœ ',
      'å¿«é€Ÿçœ¼åŠ¨': 'å¿«é€Ÿå‹•çœ¼æœŸ',
      'REMç¡çœ ': 'å¿«é€Ÿå‹•çœ¼æœŸç¡çœ ',
      'éREMç¡çœ ': 'éå¿«é€Ÿå‹•çœ¼æœŸç¡çœ ',
      'ç¡çœ é€±æœŸ': 'ç¡çœ é€±æœŸ',
      'ç”Ÿç‰©é’Ÿ': 'ç”Ÿç†æ™‚é˜',
      'ç”Ÿç‰©é˜': 'ç”Ÿç†æ™‚é˜',
      'æ˜¼å¤œèŠ‚å¾‹': 'æ™å¤œç¯€å¾‹',
      'è¤ªé»‘ç´ ': 'è¤ªé»‘æ¿€ç´ ',
      'è¤ªé»‘æ¿€ç´ åˆ†æ³Œ': 'è¤ªé»‘æ¿€ç´ åˆ†æ³Œ',
      'çš®è´¨é†‡': 'çš®è³ªé†‡',
      'å‹åŠ›è·å°”è’™': 'å£“åŠ›è·çˆ¾è’™',
      'å‹åŠ›æ¿€ç´ ': 'å£“åŠ›è·çˆ¾è’™',
      'è¡€æ¸…ç´ ': 'è¡€æ¸…ç´ ',
      'å¤šå·´èƒº': 'å¤šå·´èƒº',
      'ç¥ç»ä¼ å¯¼ç‰©è´¨': 'ç¥ç¶“å‚³å°ç‰©è³ª',
      'ç¥ç»é€’è´¨': 'ç¥ç¶“å‚³å°ç‰©è³ª',
      'èªçŸ¥è¡Œçˆ²ç™‚æ³•': 'èªçŸ¥è¡Œç‚ºç™‚æ³•',
      'è®¤çŸ¥è¡Œä¸ºç–—æ³•': 'èªçŸ¥è¡Œç‚ºç™‚æ³•',
      'CBT-Iç™‚æ³•': 'å¤±çœ èªçŸ¥è¡Œç‚ºç™‚æ³•',
      'ç¡çœ å«ç”Ÿ': 'ç¡çœ è¡›ç”Ÿ',
      'ç¡çœ ä¹ æƒ¯': 'ç¡çœ ç¿’æ…£',
      'ç¡çœ ç¯å¢ƒ': 'ç¡çœ ç’°å¢ƒ',
      'ç¡çœ éšœç¢': 'ç¡çœ éšœç¤™',
      'ç¡çœ å‘¼å¸ä¸­æ­¢': 'ç¡çœ å‘¼å¸ä¸­æ­¢ç—‡',
      'æ‰“é¼¾': 'æ‰“é¼¾',
      'å¤œé—´è§‰é†’': 'å¤œé–“è¦ºé†’',
      'æ—©é†’': 'æ—©é†’',
      'å…¥ç¡å»¶è¿Ÿ': 'å…¥ç¡å»¶é²',
      'ç¡çœ æ½œä¼æœŸ': 'å…¥ç¡æ™‚é–“',
      'ç¡çœ æ•ˆç‡': 'ç¡çœ æ•ˆç‡',
      'æ€»ç¡çœ æ—¶é—´': 'ç¸½ç¡çœ æ™‚é–“',
      'å§åºŠæ—¶é—´': 'è‡¥åºŠæ™‚é–“',
      'ç¡çœ æ—¥è®°': 'ç¡çœ æ—¥èªŒ',
      'ç¡çœ è®°å½•': 'ç¡çœ è¨˜éŒ„',
      'ç¡çœ è¿½è¸ª': 'ç¡çœ è¿½è¹¤',
      'ç¡çœ ç›‘æµ‹': 'ç¡çœ ç›£æ¸¬',
      'å¤šå¯¼ç¡çœ å›¾': 'å¤šå°ç¡çœ æª¢æŸ¥',
      'PSGæ£€æŸ¥': 'å¤šå°ç¡çœ æª¢æŸ¥',
      'ç¡çœ åˆ†æœŸ': 'ç¡çœ éšæ®µ',
      'æ·±ç¡æœŸ': 'æ·±å±¤ç¡çœ æœŸ',
      'æµ…ç¡æœŸ': 'æ·ºå±¤ç¡çœ æœŸ',
      'å…¥ç¡æœŸ': 'å…¥ç¡æœŸ',
      'å¤¢éŠç—‡': 'å¤¢éŠç—‡',
      'å¤œæƒŠ': 'å¤œé©š',
      'å™©æ¢¦': 'æƒ¡å¤¢',
      'åšå™©æ¢¦': 'åšæƒ¡å¤¢'
    }
  };

  /**
   * çµ±ä¸€è½‰æ›ç‚ºç¹é«”ä¸­æ–‡
   */
  static unifyTraditionalChinese(text) {
    if (!text) return text;
    
    let result = text;
    
    // ä½¿ç”¨å°ç…§è¡¨é€å­—è½‰æ›
    Object.entries(this.simplifiedToTraditionalMap).forEach(([simplified, traditional]) => {
      // ä½¿ç”¨å…¨å±€æ­£å‰‡è¡¨é”å¼æ›¿æ›æ‰€æœ‰å‡ºç¾
      const regex = new RegExp(simplified, 'g');
      result = result.replace(regex, traditional);
    });
    
    return result;
  }

  /**
   * ç§»é™¤éä¸­æ–‡å­—ç¬¦ï¼ˆä¿ç•™æ¨™é»ã€æ•¸å­—ã€è‹±æ–‡å°ˆæœ‰åè©ï¼‰
   */
  static removeInvalidCharacters(text) {
    if (!text) return text;
    
    // ç§»é™¤è¶Šå—æ–‡å­—ç¬¦
    text = text.replace(/[\u0080-\u024F]/g, '');
    
    // ç§»é™¤é˜¿æ‹‰ä¼¯æ–‡
    text = text.replace(/[\u0600-\u06FF]/g, '');
    
    // ç§»é™¤æ³°æ–‡
    text = text.replace(/[\u0E00-\u0E7F]/g, '');
    
    // ç§»é™¤éŸ“æ–‡
    text = text.replace(/[\uAC00-\uD7AF]/g, '');
    
    // ç§»é™¤æ—¥æ–‡å¹³å‡åç‰‡å‡åï¼ˆä¿ç•™æ¼¢å­—ï¼‰
    text = text.replace(/[\u3040-\u309F\u30A0-\u30FF]/g, '');
    
    // ç§»é™¤å…¶ä»–ç‰¹æ®ŠUnicodeå­—ç¬¦ï¼Œä½†ä¿ç•™:
    // - ä¸­æ–‡ \u4e00-\u9fa5
    // - è‹±æ–‡ a-zA-Z
    // - æ•¸å­— 0-9
    // - å¸¸ç”¨æ¨™é» \s\.,!?;:()ï¼ˆï¼‰ã€ï¼Œã€‚ï¼ï¼Ÿï¼›ï¼šã€Œã€ã€ã€â€¦â€”\-\[\]ã€ã€‘
    // - HTMLæ¨™ç±¤ <>/=&"'
    
    // ä¸åšéåº¦éæ¿¾ï¼Œåªç§»é™¤æ˜é¡¯çš„å¤–èªå­—ç¬¦
    return text;
  }

  /**
   * å°ˆæ¥­è¡“èªæ ¡æ­£
   */
  static correctTerminology(text, domain = 'health') {
    if (!text) return text;
    
    const corrections = this.terminologyCorrections[domain] || {};
    let result = text;
    
    // æŒ‰ç…§è¡“èªé•·åº¦æ’åºï¼ˆé•·çš„å„ªå…ˆï¼‰ï¼Œé¿å…éƒ¨åˆ†æ›¿æ›å•é¡Œ
    const sortedCorrections = Object.entries(corrections).sort((a, b) => 
      b[0].length - a[0].length
    );
    
    sortedCorrections.forEach(([wrong, correct]) => {
      const regex = new RegExp(wrong.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
      result = result.replace(regex, correct);
    });
    
    return result;
  }

  /**
   * HTMLæ¨™ç±¤ä¿®å¾©
   */
  static fixHTMLTags(html) {
    if (!html) return html;
    
    let result = html;

    // ğŸ†• ä¿®å¾©è¢«ç©ºæ ¼åˆ†éš”çš„æ¨™ç±¤ (å¦‚ < strong >)
    result = result.replace(/<\s*strong\s*>/gi, '<strong>');
    result = result.replace(/<\s*\/\s*strong\s*>/gi, '</strong>');
    result = result.replace(/<\s*em\s*>/gi, '<em>');
    result = result.replace(/<\s*\/\s*em\s*>/gi, '</em>');
    result = result.replace(/<\s*p\s*>/gi, '<p>');
    result = result.replace(/<\s*\/\s*p\s*>/gi, '</p>');
    result = result.replace(/<\s*li\s*>/gi, '<li>');
    result = result.replace(/<\s*\/\s*li\s*>/gi, '</li>');
    result = result.replace(/<\s*ul\s*>/gi, '<ul>');
    result = result.replace(/<\s*\/\s*ul\s*>/gi, '</ul>');
    
    // ä¿®å¾©ä¸­æ–‡æ¨™ç±¤åç¨±
    result = result.replace(/<å¼·èª¿/g, '<strong>');
    result = result.replace(/<\/å¼·èª¿>/g, '</strong>');
    result = result.replace(/<ç²—é«”/g, '<strong>');
    result = result.replace(/<\/ç²—é«”>/g, '</strong>');
    result = result.replace(/<æ–œé«”/g, '<em>');
    result = result.replace(/<\/æ–œé«”>/g, '</em>');
    
    // ä¿®å¾©æœªé–‰åˆçš„strongæ¨™ç±¤
    const strongOpenCount = (result.match(/<strong>/g) || []).length;
    const strongCloseCount = (result.match(/<\/strong>/g) || []).length;
    if (strongOpenCount > strongCloseCount) {
      result += '</strong>'.repeat(strongOpenCount - strongCloseCount);
    }
    
    // ä¿®å¾©æœªé–‰åˆçš„emæ¨™ç±¤
    const emOpenCount = (result.match(/<em>/g) || []).length;
    const emCloseCount = (result.match(/<\/em>/g) || []).length;
    if (emOpenCount > emCloseCount) {
      result += '</em>'.repeat(emOpenCount - emCloseCount);
    }
    
    // ä¿®å¾©å¤šé¤˜çš„ç©ºç™½æ¨™ç±¤
    result = result.replace(/<strong>\s*<\/strong>/g, '');
    result = result.replace(/<em>\s*<\/em>/g, '');
    
    // ä¿®å¾©é€£çºŒçš„æ¨™ç±¤
    result = result.replace(/<\/strong>\s*<strong>/g, '');
    result = result.replace(/<\/em>\s*<em>/g, '');
    
    return result;
  }

  /**
   * ç¶œåˆå…§å®¹æ¸…ç†ï¼ˆä¸»è¦æ–¹æ³•ï¼‰
   */
  static async cleanContent(content, options = {}) {
    const { domain = 'health', skipHTML = false } = options;
    
    if (!content) return content;
    
    // è™•ç†ä¸åŒé¡å‹çš„è¼¸å…¥
    let isObject = false;
    let originalContent = content;
    
    if (typeof content === 'object') {
      isObject = true;
      content = JSON.stringify(content);
    }
    
    let cleaned = content;
    
    console.log('ğŸ§¹ é–‹å§‹å…§å®¹æ¸…ç†...');
    
    // 1. ç§»é™¤ç„¡æ•ˆå­—ç¬¦
    const beforeInvalidChars = cleaned;
    cleaned = this.removeInvalidCharacters(cleaned);
    if (beforeInvalidChars !== cleaned) {
      console.log('  âœ“ ç§»é™¤äº†ç„¡æ•ˆå­—ç¬¦');
    }
    
    // 2. ç°¡ç¹è½‰æ›
    const beforeTraditional = cleaned;
    cleaned = this.unifyTraditionalChinese(cleaned);
    if (beforeTraditional !== cleaned) {
      console.log('  âœ“ çµ±ä¸€ç‚ºç¹é«”ä¸­æ–‡');
    }
    
    // 3. è¡“èªæ ¡æ­£
    const beforeTerminology = cleaned;
    cleaned = this.correctTerminology(cleaned, domain);
    if (beforeTerminology !== cleaned) {
      console.log('  âœ“ æ ¡æ­£å°ˆæ¥­è¡“èª');
    }
    
    // 4. HTMLä¿®å¾©ï¼ˆå¦‚æœå…§å®¹åŒ…å«HTMLï¼‰
    if (!skipHTML && cleaned.includes('<')) {
      const beforeHTML = cleaned;
      cleaned = this.fixHTMLTags(cleaned);
      if (beforeHTML !== cleaned) {
        console.log('  âœ“ ä¿®å¾©HTMLæ¨™ç±¤');
      }
    }
    
    // æ¢å¾©åŸå§‹é¡å‹
    if (isObject) {
      try {
        cleaned = JSON.parse(cleaned);
      } catch (error) {
        console.error('âŒ JSONè§£æå¤±æ•—ï¼Œè¿”å›å­—ä¸²:', error.message);
        // å¦‚æœJSONè§£æå¤±æ•—ï¼Œè¿”å›åŸå§‹å°è±¡
        return originalContent;
      }
    }
    
    console.log('âœ… å…§å®¹æ¸…ç†å®Œæˆ');
    
    return cleaned;
  }

  /**
   * å¿«é€Ÿæª¢æŸ¥å…§å®¹å“è³ª
   */
  static quickCheck(text) {
    const issues = [];
    
    if (!text) {
      return { passed: false, issues: ['å…§å®¹ç‚ºç©º'] };
    }
    
    // æª¢æŸ¥ç°¡é«”å­—
    const simplifiedChars = Object.keys(this.simplifiedToTraditionalMap).slice(0, 50);
    const foundSimplified = simplifiedChars.filter(char => text.includes(char));
    if (foundSimplified.length > 0) {
      issues.push(`æª¢æ¸¬åˆ°ç°¡é«”å­—: ${foundSimplified.slice(0, 5).join(', ')}...`);
    }
    
    return {
      passed: issues.length === 0,
      issues
    };
  }

  /**
   * ğŸ†• æª¢æ¸¬æ©Ÿæ¢°å¼å¥å‹æ¨¡æ¿
   */
  static detectMechanicalPatterns(text) {
    const found = [];
    
    this.mechanicalPatterns.forEach(pattern => {
      const matches = text.match(pattern);
      if (matches && matches.length > 0) {
        matches.forEach(match => {
          found.push({
            type: 'mechanical_pattern',
            text: match,
            severity: 'warning',
            suggestion: 'æ­¤å¥å‹ç‚ºæ©Ÿæ¢°å¼æ¨¡æ¿ï¼Œå»ºè­°æ”¹å¯«ç‚ºæ›´è‡ªç„¶çš„è¡¨é”æ–¹å¼'
          });
        });
      }
    });
    
    return found;
  }

  /**
   * ğŸ†• æª¢æ¸¬è™›å‡è²ç¨±
   */
  static detectFalseClaims(text) {
    const found = [];
    
    this.falseClaimPatterns.forEach(pattern => {
      const matches = text.match(pattern);
      if (matches && matches.length > 0) {
        matches.forEach(match => {
          found.push({
            type: 'false_claim',
            text: match,
            severity: 'error',
            suggestion: 'æ­¤ç‚ºä¸å¯è¿½æº¯çš„è™›å‡è²ç¨±ï¼Œå¿…é ˆç§»é™¤æˆ–æ”¹å¯«ç‚ºå¯è¿½æº¯çš„å¼•ç”¨'
          });
        });
      }
    });
    
    return found;
  }

  /**
   * ğŸ†• é©—è­‰é—œéµå­—å¯†åº¦ï¼ˆäº‹å¾Œæª¢æŸ¥ï¼‰
   */
  static validateKeywordDensity(text, keyword) {
    if (!text || !keyword) {
      return { passed: true, message: 'ç„¡æ³•é©—è­‰' };
    }

    // è¨ˆç®—ç´”æ–‡æœ¬ï¼ˆç§»é™¤HTMLï¼‰
    const plainText = text.replace(/<[^>]*>/g, '').replace(/\s+/g, '');
    const totalChars = plainText.length;

    // è¨ˆç®—é—œéµå­—å‡ºç¾æ¬¡æ•¸
    const regex = new RegExp(keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');
    const matches = text.match(regex);
    const count = matches ? matches.length : 0;

    // è¨ˆç®—å¯†åº¦
    const density = totalChars > 0 ? (count / totalChars) : 0;
    const densityPercent = (density * 100).toFixed(2);

    // åˆ¤æ–·æ˜¯å¦éé«˜
    const isPassed = density <= 0.015; // 1.5% ç‚ºä¸Šé™
    const isWarning = density > 0.012; // 1.2% ä»¥ä¸Šè­¦å‘Š

    return {
      passed: isPassed,
      warning: isWarning,
      density: densityPercent,
      count: count,
      totalChars: totalChars,
      message: isPassed 
        ? `é—œéµå­—å¯†åº¦æ­£å¸¸ (${densityPercent}%)` 
        : `âš ï¸ é—œéµå­—å¯†åº¦éé«˜ (${densityPercent}%)ï¼Œå¯èƒ½è¢«è¦–ç‚º Keyword Stuffing`
    };
  }

  /**
   * ğŸ†• å¼·åˆ¶ä¾†æºå¯è¿½æº¯æ€§æª¢æŸ¥
   */
  static enforceSourceTraceability(text) {
    const issues = [];
    
    // æª¢æ¸¬ç©ºæ´å¼•ç”¨
    const emptyReferencePatterns = [
      /æ ¹æ“šç ”ç©¶(é¡¯ç¤º|æŒ‡å‡º|è¡¨æ˜)/g,
      /å°ˆå®¶(å»ºè­°|æŒ‡å‡º|è¡¨ç¤º)/g,
      /ç ”ç©¶(æŒ‡å‡º|é¡¯ç¤º|è¡¨æ˜)/g,
      /æ ¹æ“šèª¿æŸ¥/g,
      /æ•¸æ“šé¡¯ç¤º/g
    ];

    emptyReferencePatterns.forEach(pattern => {
      const matches = text.match(pattern);
      if (matches && matches.length > 0) {
        matches.forEach(match => {
          issues.push({
            type: 'empty_reference',
            text: match,
            severity: 'error',
            suggestion: 'å¿…é ˆæä¾›å…·é«”ä¾†æºåç¨±ã€å¹´ä»½æˆ–é€£çµï¼Œä¾‹å¦‚ï¼šã€Œæ ¹æ“šç¾åœ‹XXå”æœƒ(2023)ç ”ç©¶é¡¯ç¤ºã€'
          });
        });
      }
    });

    return issues;
  }

  /**
   * ğŸ†• ç¶œåˆå“è³ªå ±å‘Šï¼ˆåŒ…å«æ‰€æœ‰æª¢æŸ¥ï¼‰
   */
  static generateQualityReport(article, targetKeyword = '') {
    // âœ… P0ä¿®å¾©: åªæå–å¯¦éš›HTMLå…§å®¹é€²è¡Œæª¢æ¸¬ï¼Œé¿å…é‡è¤‡è¨ˆç®—metadata
    const fullText = [
      article.content?.introduction?.html || '',
      ...(article.content?.sections || []).map(s => s.html || ''),
      article.content?.conclusion?.html || ''
    ].join('\n');
    
    const report = {
      timestamp: new Date().toISOString(),
      checks: {
        mechanicalPatterns: this.detectMechanicalPatterns(fullText),
        falseClaims: this.detectFalseClaims(fullText),
        emptyReferences: this.enforceSourceTraceability(fullText),
        keywordDensity: this.validateKeywordDensity(fullText, targetKeyword)
      },
      summary: {
        totalIssues: 0,
        errors: 0,
        warnings: 0
      }
    };

    // çµ±è¨ˆå•é¡Œæ•¸é‡
    Object.keys(report.checks).forEach(checkType => {
      if (Array.isArray(report.checks[checkType])) {
        report.checks[checkType].forEach(issue => {
          report.summary.totalIssues++;
          if (issue.severity === 'error') {
            report.summary.errors++;
          } else if (issue.severity === 'warning') {
            report.summary.warnings++;
          }
        });
      }
    });

    // åˆ¤æ–·æ•´é«”æ˜¯å¦é€šé
    report.passed = report.summary.errors === 0;
    report.passedWithWarnings = report.summary.errors === 0 && report.summary.warnings > 0;

    return report;
  }
}

module.exports = ContentFilterService;
