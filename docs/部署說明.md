# ContentPilot AI - Nginx é…ç½®èˆ‡éƒ¨ç½²èªªæ˜

## ğŸ“‹ æª”æ¡ˆèªªæ˜

æœ¬å°ˆæ¡ˆåŒ…å«å…©å€‹ Nginx é…ç½®æª”ï¼š

### 1. `nginx.conf` - ç”Ÿç”¢ç’°å¢ƒï¼ˆLinode VPSï¼‰
- âœ… HTTPS + SSL æ†‘è­‰ï¼ˆLet's Encryptï¼‰
- âœ… å®‰å…¨æ¨™é ­èˆ‡é˜²è­·
- âœ… é˜²ç›œéˆèˆ‡ Rate Limiting
- âœ… å‰ç«¯ï¼ˆSPAï¼‰+ API å¾Œç«¯åˆ†é›¢
- âœ… éœæ…‹æ–‡ä»¶å¿«å–å„ªåŒ–

### 2. `nginx-dev.conf` - é–‹ç™¼ç’°å¢ƒï¼ˆæœ¬åœ°ï¼‰
- âœ… HTTPï¼ˆç„¡ SSLï¼‰
- âœ… ä»£ç† Vite é–‹ç™¼ä¼ºæœå™¨
- âœ… æ”¯æ´ Hot Module Replacement (HMR)
- âœ… ç°¡åŒ–é…ç½®ï¼Œæ–¹ä¾¿é™¤éŒ¯

---

## ğŸš€ ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²æ­¥é©Ÿï¼ˆLinodeï¼‰

### æ­¥é©Ÿ 1ï¼šé€£ç·šåˆ° Linode VPS
```bash
ssh root@your-linode-ip
```

### æ­¥é©Ÿ 2ï¼šå®‰è£ Nginx
```bash
# æ›´æ–°å¥—ä»¶
apt update && apt upgrade -y

# å®‰è£ Nginx
apt install -y nginx

# å•Ÿå‹•ä¸¦è¨­å®šé–‹æ©Ÿè‡ªå‹•å•Ÿå‹•
systemctl start nginx
systemctl enable nginx
```

### æ­¥é©Ÿ 3ï¼šå»ºç«‹ç›®éŒ„çµæ§‹
```bash
# å»ºç«‹å°ˆæ¡ˆç›®éŒ„
mkdir -p /var/www/contentpilot/{frontend/dist,uploads,temp,backups}

# è¨­å®šæ¬Šé™
chown -R www-data:www-data /var/www/contentpilot
chmod -R 755 /var/www/contentpilot
```

### æ­¥é©Ÿ 4ï¼šè¤‡è£½ Nginx é…ç½®
```bash
# ä¸Šå‚³ nginx.conf åˆ°ä¼ºæœå™¨
scp nginx.conf root@your-linode-ip:/etc/nginx/sites-available/contentpilot

# å»ºç«‹ symbolic link
ln -s /etc/nginx/sites-available/contentpilot /etc/nginx/sites-enabled/

# åˆªé™¤é è¨­é…ç½®
rm /etc/nginx/sites-enabled/default
```

### æ­¥é©Ÿ 5ï¼šè¨­å®š SSL æ†‘è­‰ï¼ˆLet's Encryptï¼‰
```bash
# å®‰è£ Certbot
apt install -y certbot python3-certbot-nginx

# å–å¾—æ†‘è­‰ï¼ˆè‡ªå‹•é…ç½® Nginxï¼‰
certbot --nginx -d contentpilot.com -d www.contentpilot.com -d api.contentpilot.com

# è¨­å®šè‡ªå‹•æ›´æ–°æ†‘è­‰
certbot renew --dry-run
```

### æ­¥é©Ÿ 6ï¼šæ¸¬è©¦èˆ‡é‡å•Ÿ Nginx
```bash
# æ¸¬è©¦é…ç½®æ˜¯å¦æ­£ç¢º
nginx -t

# é‡æ–°è¼‰å…¥é…ç½®
systemctl reload nginx

# æª¢æŸ¥ç‹€æ…‹
systemctl status nginx
```

### æ­¥é©Ÿ 7ï¼šè¨­å®šé˜²ç«ç‰†
```bash
# å…è¨± HTTP/HTTPS
ufw allow 'Nginx Full'

# æˆ–æ‰‹å‹•è¨­å®š
ufw allow 80/tcp
ufw allow 443/tcp

# å•Ÿç”¨é˜²ç«ç‰†
ufw enable
```

---

## ğŸ’» æœ¬åœ°é–‹ç™¼ç’°å¢ƒè¨­å®šï¼ˆWindowsï¼‰

### æ­¥é©Ÿ 1ï¼šå®‰è£ Nginxï¼ˆWindowsï¼‰
```powershell
# ä½¿ç”¨ Chocolatey å®‰è£
choco install nginx

# æˆ–å¾å®˜ç¶²ä¸‹è¼‰ï¼šhttp://nginx.org/en/download.html
# è§£å£“åˆ° C:\nginx
```

### æ­¥é©Ÿ 2ï¼šè¤‡è£½é–‹ç™¼é…ç½®
```powershell
# è¤‡è£½ nginx-dev.conf åˆ° Nginx ç›®éŒ„
Copy-Item nginx-dev.conf C:\nginx\conf\nginx.conf
```

### æ­¥é©Ÿ 3ï¼šå•Ÿå‹• Nginx
```powershell
# é€²å…¥ Nginx ç›®éŒ„
cd C:\nginx

# å•Ÿå‹• Nginx
.\nginx.exe

# é‡æ–°è¼‰å…¥é…ç½®
.\nginx.exe -s reload

# åœæ­¢ Nginx
.\nginx.exe -s stop
```

### æ­¥é©Ÿ 4ï¼šæ¸¬è©¦
```powershell
# ç€è¦½å™¨é–‹å•Ÿ
http://localhost
```

---

## ğŸ”§ å¸¸è¦‹è¨­å®šèª¿æ•´

### 1. ä¿®æ”¹ API ç«¯å£
å¦‚æœæ‚¨çš„ Node.js æˆ– Python æœå‹™ä½¿ç”¨ä¸åŒç«¯å£ï¼š

```nginx
# åœ¨ nginx.conf ä¸­æ‰¾åˆ°ä¸¦ä¿®æ”¹
location /api/ {
    proxy_pass http://localhost:3000;  # â† æ”¹æˆæ‚¨çš„ç«¯å£
}

location /ai/ {
    proxy_pass http://localhost:8000;  # â† æ”¹æˆæ‚¨çš„ç«¯å£
}
```

### 2. å¢åŠ ä¸Šå‚³å¤§å°é™åˆ¶
```nginx
# åœ¨ server å€å¡Šä¸­ä¿®æ”¹
client_max_body_size 50M;  # æ”¹æˆæ‚¨éœ€è¦çš„å¤§å°
```

### 3. èª¿æ•´è¶…æ™‚æ™‚é–“
```nginx
# åœ¨ location /api/ ä¸­ä¿®æ”¹
proxy_read_timeout 600s;  # AI ç”Ÿæˆéœ€è¦è¼ƒé•·æ™‚é–“
```

### 4. å•Ÿç”¨ Rate Limiting
```nginx
# åœ¨ location /api/ ä¸­åŠ å…¥
limit_req zone=api_limit burst=20 nodelay;
```

---

## ğŸ› å¸¸è¦‹å•é¡Œæ’è§£

### 1. Nginx ç„¡æ³•å•Ÿå‹•
```bash
# æª¢æŸ¥é…ç½®èªæ³•
nginx -t

# æŸ¥çœ‹éŒ¯èª¤æ—¥èªŒ
tail -f /var/log/nginx/error.log
```

### 2. 502 Bad Gateway
**åŸå› **ï¼šå¾Œç«¯æœå‹™æœªå•Ÿå‹•

```bash
# æª¢æŸ¥ Node.js æœå‹™
netstat -tlnp | grep 3000

# æª¢æŸ¥ Python æœå‹™
netstat -tlnp | grep 8000

# å¦‚æœæ²’æœ‰ï¼Œå•Ÿå‹•æœå‹™
cd /var/www/contentpilot/backend
npm start

cd /var/www/contentpilot/ai-service
python app.py
```

### 3. åœ–ç‰‡ç„¡æ³•è¼‰å…¥
```bash
# æª¢æŸ¥æ¬Šé™
ls -la /var/www/contentpilot/uploads

# ä¿®æ­£æ¬Šé™
chown -R www-data:www-data /var/www/contentpilot/uploads
chmod -R 755 /var/www/contentpilot/uploads
```

### 4. CORS éŒ¯èª¤
åœ¨ `nginx.conf` ä¸­ç¢ºèª CORS æ¨™é ­ï¼š
```nginx
add_header 'Access-Control-Allow-Origin' 'https://contentpilot.com' always;
```

---

## ğŸ“Š æ•ˆèƒ½å„ªåŒ–å»ºè­°

### 1. å•Ÿç”¨ HTTP/2
```nginx
listen 443 ssl http2;  # â† ç¢ºä¿æœ‰ http2
```

### 2. å•Ÿç”¨ Gzip å£“ç¸®
```nginx
gzip on;
gzip_comp_level 6;
gzip_types text/plain text/css application/json application/javascript;
```

### 3. éœæ…‹æ–‡ä»¶å¿«å–
```nginx
location ~* \.(jpg|jpeg|png|webp)$ {
    expires 30d;
    add_header Cache-Control "public, immutable";
}
```

### 4. é€£ç·šæ± å„ªåŒ–
```nginx
# åœ¨ http å€å¡Šä¸­åŠ å…¥
keepalive_timeout 65;
keepalive_requests 100;
```

---

## ğŸ” å®‰å…¨æ€§æª¢æŸ¥æ¸…å–®

- âœ… HTTPS å·²å•Ÿç”¨ï¼ˆLet's Encryptï¼‰
- âœ… å®‰å…¨æ¨™é ­å·²è¨­å®šï¼ˆHSTS, X-Frame-Optionsï¼‰
- âœ… é˜²ç›œéˆå·²å•Ÿç”¨ï¼ˆvalid_referersï¼‰
- âœ… Rate Limiting å·²è¨­å®š
- âœ… éš±è— Nginx ç‰ˆæœ¬è™Ÿï¼ˆserver_tokens offï¼‰
- âœ… é˜²ç«ç‰†å·²è¨­å®šï¼ˆUFWï¼‰
- âœ… å®šæœŸæ›´æ–°æ†‘è­‰ï¼ˆcertbot renewï¼‰

---

## ğŸ“ ç›£æ§èˆ‡æ—¥èªŒ

### æŸ¥çœ‹å³æ™‚æ—¥èªŒ
```bash
# å­˜å–æ—¥èªŒ
tail -f /var/log/nginx/contentpilot-api-access.log

# éŒ¯èª¤æ—¥èªŒ
tail -f /var/log/nginx/contentpilot-api-error.log
```

### æ—¥èªŒåˆ†æ
```bash
# å®‰è£ GoAccessï¼ˆè¦–è¦ºåŒ–æ—¥èªŒåˆ†æå·¥å…·ï¼‰
apt install -y goaccess

# åˆ†ææ—¥èªŒ
goaccess /var/log/nginx/contentpilot-api-access.log -o report.html --log-format=COMBINED
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥

é…ç½®å®Œæˆå¾Œï¼Œæ‚¨éœ€è¦ï¼š

1. âœ… éƒ¨ç½²å‰ç«¯æ‡‰ç”¨ï¼ˆReactï¼‰åˆ° `/var/www/contentpilot/frontend/dist`
2. âœ… å•Ÿå‹• Node.js å¾Œç«¯æœå‹™ï¼ˆPort 3000ï¼‰
3. âœ… å•Ÿå‹• Python AI æœå‹™ï¼ˆPort 8000ï¼‰
4. âœ… è¨­å®šç’°å¢ƒè®Šæ•¸ï¼ˆ`.env`ï¼‰
5. âœ… å•Ÿå‹•è³‡æ–™åº«ï¼ˆPostgreSQL, MongoDB, Redisï¼‰

**å»ºè­°ä½¿ç”¨ PM2 ç®¡ç† Node.js æœå‹™ï¼š**
```bash
npm install -g pm2
pm2 start server.js --name contentpilot-api
pm2 startup
pm2 save
```

æœ‰ä»»ä½•å•é¡Œæ­¡è¿åƒè€ƒå®˜æ–¹æ–‡ä»¶ï¼š
- Nginx: https://nginx.org/en/docs/
- Let's Encrypt: https://letsencrypt.org/docs/
- PM2: https://pm2.keymetrics.io/
